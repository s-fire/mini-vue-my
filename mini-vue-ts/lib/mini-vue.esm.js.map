{"version":3,"file":"mini-vue.esm.js","sources":["../src/shared/ShapeFlags.ts","../src/runtime-core/componentPublicInstance.ts","../src/runtime-core/component.ts","../src/runtime-core/render.ts","../src/runtime-core/vnode.ts","../src/runtime-core/createApp.ts","../src/runtime-core/h.ts"],"sourcesContent":["export const enum ShapeFlags {\n  ELEMENT = 1, //0001\n  STATEFUL_COMPONENT = 1 << 1, // 0010\n  TEXT_CHILDREN = 1 << 2, // 0100\n  ARRAY_CHILDREN = 1 << 3, // 1000\n}\n","const publicPropertiesMap = {\n  $el:(i)=> i.vnode.el\n}\nexport const publicInstanceProxyHandlers = {\n  get({_:instance},key){\n    const {setupState} = instance\n    if (key in setupState) {\n      return setupState[key]\n    }\n    const publicGetter = publicPropertiesMap[key]\n    if (publicGetter) {\n      return publicGetter(instance)\n    }\n  }\n}","import { publicInstanceProxyHandlers } from \"./componentPublicInstance\"\n\nexport function createComponentInstance(vnode) {\n  const component = {\n    vnode,\n    type:vnode.type,\n    setupState:{} // 保存setup的返回内容\n  }\n  return component\n}\nexport function setupComponent(instance: { vnode: any }) {\n  /* \n    instance{  // 组件实例\n      vnode{  // 组件虚拟节点\n        type // 传入的App组件配置\n      } \n      type // 传入的App组件配置\n    }\n  */\n  // 实例化有状态组件\n  setupStatefulComponent(instance)\n}\n\nfunction setupStatefulComponent(instance: any) {\n  /* \n    instance{  // 组件实例\n      vnode{  // 组件虚拟节点\n        type // 传入的App组件配置\n      } \n      type // 传入的App组件配置\n    }\n  */\n  const Component = instance.type // 传入的App配置\n  // 创建组件代理对象  用于访问this.xxx\n  instance.proxy = new Proxy({_:instance},publicInstanceProxyHandlers)\n  // 取到App里的setup函数\n  const {setup} = Component\n  if (setup) {\n    const setupResult = setup()\n    handleSetupResult(instance,setupResult)\n  }\n}\nfunction handleSetupResult(instance,setupResult: any) {\n  // setup函数有可能返回函数或者对象\n  if (typeof(setupResult) === 'object') {\n    // 把setup返回的对象保存到实例上\n    instance.setupState = setupResult\n  }\n  finishComponentSetup(instance)\n}\n\nfunction finishComponentSetup(instance: any) {\n  const Component = instance.type\n  if (Component.render) {\n    instance.render =Component.render\n  }\n}\n\n","import { isObject } from \"../shared\";\nimport { ShapeFlags } from \"../shared/ShapeFlags\";\nimport { createComponentInstance, setupComponent } from \"./component\";\n\nexport function render(vnode, container) {\n  patch(vnode, container);\n}\nfunction patch(vnode, container) {\n  const { shapeFlag } = vnode;\n  // 这里是 & 运算  获取当前vnode的类型\n  if (shapeFlag & ShapeFlags.ELEMENT) {\n    // 处理元素\n    processElement(vnode, container);\n  } else if (shapeFlag & ShapeFlags.STATEFUL_COMPONENT) {\n    // 处理组件\n    processComponent(vnode, container);\n  }\n}\nfunction processElement(vnode: any, container: any) {\n  // 初始化元素\n  mountElement(vnode, container);\n}\nfunction mountElement(vnode: any, container: any) {\n  const el: HTMLElement = (vnode.el = document.createElement(vnode.type));\n  const { children, shapeFlag } = vnode;\n  if (shapeFlag & ShapeFlags.TEXT_CHILDREN) {\n    // 文本内容直接设置\n    el.textContent = children;\n  } else if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {\n    // 数组类型 遍历后调用Patch\n    mountChildren(vnode, el);\n  }\n  // 处理props属性\n  const { props } = vnode;\n  for (const key in props) {\n    const element = props[key];\n    const isOn = (key: string) => /^on[A-Z]/.test(key);\n    if (isOn(key)) {\n      const evnet = key.slice(2).toLowerCase();\n      el.addEventListener(evnet, element);\n    } else {\n      el.setAttribute(key, element);\n    }\n  }\n  container.append(el);\n}\nfunction mountChildren(vnode: any, el: HTMLElement) {\n  vnode.children.forEach((element) => {\n    patch(element, el);\n  });\n}\n\n// 处理组件\nfunction processComponent(vnode: any, container: any) {\n  // 挂载组件\n  mountComponent(vnode, container);\n}\n// 挂载组件\nfunction mountComponent(initalVnode: any, container) {\n  // 创建组件实例\n  const instance = createComponentInstance(initalVnode);\n  setupComponent(instance);\n  setupRederEffect(instance, initalVnode, container);\n}\n\nfunction setupRederEffect(instance: any, initalVnode, container) {\n  const { proxy } = instance;\n  const subTree = instance.render.call(proxy);\n  // subTree h函数返回的内容\n  patch(subTree, container);\n  initalVnode.el = subTree.el; // 把根节点的el保存到当前组件的虚拟节点上 用于this.$el访问\n}\n","import { ShapeFlags } from \"../shared/ShapeFlags\";\n\nexport function createVnode(type, props?, children?) {\n  // type传入的App配置\n  const vnode = {\n    type,\n    props,\n    children,\n    shapeFlag: getShapeFlage(type),\n    el: null, // 保存当前的el dom\n  };\n  // children  这里可以理解为  | 运算 后的结果同时保留了原本的shapeFlag和children的shapeFlage\n  if (typeof children === \"string\") {\n    vnode.shapeFlag = vnode.shapeFlag | ShapeFlags.TEXT_CHILDREN;\n  }else if (Array.isArray(children)) {\n    vnode.shapeFlag = vnode.shapeFlag | ShapeFlags.ARRAY_CHILDREN\n  }\n  return vnode;\n}\n// 设置vnode对应的shapeFlag\n/* \n  位运算  | 运算时 有 1 得1  & 运算时  全是1才得1  \n*/\nfunction getShapeFlage(type: any) {\n  return typeof type === \"string\"\n    ? ShapeFlags.ELEMENT\n    : ShapeFlags.STATEFUL_COMPONENT;\n}\n/* \n  0001\n  0100\n  0101\n  1000\n*/\n","import { render } from \"./render\"\nimport { createVnode } from \"./vnode\"\n\nexport function createApp(rootComponent){\n  // 传入的App配置\n  return {\n    mount(rootContainer){\n      // 转换成虚拟节点\n      // component -> vnode\n      const vnode = createVnode(rootComponent)\n      render(vnode,rootContainer)\n    }\n  }\n}\n","import { createVnode } from \"./vnode\";\nexport function h(type,props?,children?) {\n  return createVnode(type,props,children)\n}"],"names":[],"mappings":"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"}